# 🔅System programming week10🔅

# 📁 파일 시스템 구조

## 🔹 부트블록 (Boot Block)
- 파일 시스템 시작 부에 위치 (보통 첫 번째 섹터)
- **부트스트랩 코드**가 저장됨

## 🔹 슈퍼블록 (Super Block)
- 전체 파일 시스템에 대한 **메타데이터** 저장
- 포함 정보:
  - 총 블록 수
  - 사용 가능한 i-노드 개수
  - 사용 가능한 블록 비트맵
  - 블록의 크기
  - 사용 중인 블록 수
  - 사용 가능한 블록 수 등

## 🔹 i-리스트 (i-list)
- 각 파일을 나타내는 **모든 i-노드들의 리스트**
- 한 블록은 약 **40개의 i-노드**를 포함

## 🔹 데이터 블록 (Data Block)
- 실제 **파일의 내용(데이터)** 저장용 블록들

# 🧱 i-노드 (i-Node)

## 📌 개요
- **한 파일은 하나의 i-노드**를 가짐
- 파일에 대한 **모든 메타정보**를 저장

## 📄 i-노드에 저장되는 정보
- 📂 파일 타입: 일반 파일, 디렉터리, 블록 장치, 문자 장치 등
- 📏 파일 크기
- 🔐 사용 권한
- 👤 파일 소유자 및 그룹
- 🕒 접근 및 갱신 시간
- 📍 데이터 블록에 대한 포인터(주소) 등

# 🧭 블록 포인터

## 📌 개요
- **데이터 블록에 대한 포인터**는 파일의 실제 내용을 저장하는 블록들의 주소를 가리킴
- 이 포인터들은 i-노드 내부에 저장되어 있음

## 📂 i-노드 내 블록 포인터 구성
- 🔟 **직접 블록 포인터**: 10개  
  → 각 포인터는 하나의 데이터 블록을 직접 가리킴
- 1️⃣ **간접 블록 포인터**  
  → 이 포인터가 가리키는 블록은 다시 여러 개의 데이터 블록 포인터를 포함
- 1️⃣ **이중 간접 블록 포인터**  
  → 이 포인터가 가리키는 블록은 또 다른 포인터 블록을 가리키며, 그 블록이 실제 데이터 블록을 가리킴

## ❓ 최대 몇 개의 데이터 블록을 가리킬 수 있을까?
- 직접: `10` 블록  
- 간접: `블록 크기 / 포인터 크기` 만큼  
- 이중 간접: `(블록 크기 / 포인터 크기)²` 만큼  
  > 예: 블록 크기 1024바이트, 포인터 4바이트일 경우  
  - 간접: 1024 / 4 = 256  
  - 이중 간접: 256 × 256 = 65,536  
  - 총합: 10 + 256 + 65,536 = **65,802개 블록**

# 📁 파일 타입(File Types)

| 파일 타입       | 설명                                                                 |
|----------------|----------------------------------------------------------------------|
| 일반 파일       | 데이터를 갖고 있는 텍스트 파일 또는 이진 파일                          |
| 디렉터리 파일    | 파일의 이름들과 파일 정보에 대한 포인터를 포함하는 파일                  |
| 문자 장치 파일   | 문자 단위로 데이터를 전송하는 장치를 나타내는 파일 (예: 키보드, 마우스)     |
| 블록 장치 파일   | 블록 단위로 데이터를 전송하는 장치를 나타내는 파일 (예: 하드디스크)        |
| FIFO 파일       | 프로세스 간 통신에 사용되는 파일로, 이름 있는 파이프                      |
| 소켓            | 네트워크를 통한 프로세스 간 통신에 사용되는 파일                          |
| 심볼릭 링크      | 다른 파일을 가리키는 포인터 역할을 하는 파일                             |

# 🔍 파일 타입 검사 매크로 함수 (File Type Test Macros)

다음은 파일의 타입을 검사하기 위해 사용하는 매크로 함수들입니다.  
이들은 `stat()` 시스템 호출로 얻은 `st_mode` 값을 통해 파일의 종류를 판별할 수 있도록 도와줍니다.

| 파일 타입       | 검사 함수         | 설명                                        |
|----------------|-------------------|---------------------------------------------|
| 일반 파일       | `S_ISREG(mode)`   | 일반 텍스트 파일 또는 실행 파일인지 검사         |
| 디렉터리 파일    | `S_ISDIR(mode)`   | 디렉터리인지 검사                             |
| 문자 장치 파일   | `S_ISCHR(mode)`   | 문자 단위 입출력을 하는 장치 파일인지 검사         |
| 블록 장치 파일   | `S_ISBLK(mode)`   | 블록 단위 입출력을 하는 장치 파일인지 검사         |
| FIFO 파일       | `S_ISFIFO(mode)`  | 이름 있는 파이프(FIFO)인지 검사                 |
| 소켓 파일       | `S_ISSOCK(mode)`  | 소켓인지 검사                                 |
| 심볼릭 링크      | `S_ISLNK(mode)`   | 심볼릭 링크인지 검사                           |

✅ **예시 사용법**:
```c
struct stat buf;
stat("somefile", &buf);
if (S_ISDIR(buf.st_mode)) {
    printf("디렉터리입니다.\n");
}
```
<img width="510" alt="image" src="https://github.com/user-attachments/assets/99facf65-05d2-41fa-97f4-39b9bfd65554" />

